@inherits LayoutComponentBase
@inject GameState  GameState
@implements IDisposable

<div class="sidebar" style="height:100vh;overflow-y:auto">
    <NavMenu />
</div>
@if (!GameState.isSplitView)
{
    <div style="height:100vh;min-width:425px;overflow-y:scroll;padding-left:10px; padding-right:10px;" class="col-6">
        <div class="top-row px-6" style="background:#e4e4e4; padding:10px;margin-left:-10px;margin-right:-10px;">
            <table style="width:80%">
                <tr>
                    @if (GameState.CanLeave())
                    {
                        <td><a href="/Help"> Help</a></td>
                        <td><a href="/About"> About</a></td>
                        <td><a href="/Updates"> Updates(@GameState.updateVersionString)</a></td>
                        <td><a href="/Settings"> Settings</a></td>
                        @if (GameState.PetShopUnlocked)
                        {
                            <td><a href="/PetStore"> Pet Store</a></td>
                        }

                    }
                </tr>
            </table>
            <div><ExperienceCard></ExperienceCard></div>
        </div>

        <div class="content px-6">
            @Body
            <div class="footer navbar-fixed-bottom" style="padding-right:10px;padding-left:10px;margin-left:-10px;margin-right:-10px;">
                <MessagesMenu />
            </div>
        </div>

    </div>
}
else
{
    <div class="col-5" style="height:100vh;overflow-y:scroll;padding-left:10px; padding-right:10px;">
        <div class="top-row px-5" style="background:#e4e4e4;padding:10px;margin-left:-10px;margin-right:-10px;">
            <table style="width:90%">
                <tr>
                    @if (GameState.CanLeave())
                    {
                        <td><a href="/Help"> Help</a></td>
                        <td><a href="/About"> About</a></td>
                        <td><a href="/Updates"> Updates(@GameState.updateVersionString)</a></td>
                        <td><a href="/Settings"> Settings</a></td>
                        @if (GameState.PetShopUnlocked)
                        {
                            <td><a href="/PetStore"> Pet Store</a></td>
                        }
                    }

                </tr>
            </table>
            <div><ExperienceCard></ExperienceCard></div>
        </div>

        <div class="content px-5" style="padding-left:10px!important; padding-right:10px!important;">
            @Body
            <div class="footer navbar-fixed-bottom" style="padding-right:10px;padding-left:10px;margin-left:-10px;margin-right:-10px;">
                <MessagesMenu />
            </div>
        </div>

    </div>
}

@if (GameState.isSplitView)
{
    if (GameState.activeButtons[0] != null)
    {
        if (GameState.activeButtons[0] == "Inventory")
        {
            <div class="col-md-3" style="height:100vh;padding-left:0px; padding-right:0px;overflow-y:scroll">
                <Inventory splitViewPosition="0"/>
            </div>
        }
        else if (GameState.activeButtons[0] == "Skills")
        {
            <div class="col-md-3" style="height:100vh;padding-left:0px; padding-right:0px;overflow-y:scroll!important;overflow-x:hidden!important">
                <SkillsMenu splitViewPosition="0"/>
            </div>
        }
        else if (GameState.activeButtons[0] == "Crafting")
        {
            <div class="col-md-3" style="height:100vh;padding-left:0px; padding-right:0px;overflow-y:scroll!important;overflow-x:hidden!important">
                <CraftingMenu splitViewPosition="0"/>
            </div>
        }
        else if (GameState.activeButtons[0] == "Followers")
        {
            <div class="col-md-3" style="height:100vh;padding-left:0px; padding-right:0px;overflow-y:scroll!important;overflow-x:hidden!important">
                <FollowersMenu splitViewPosition="0"/>
            </div>
        }
        else if (GameState.activeButtons[0] == "Pets")
        {
            <div class="col-md-3" style="height:100vh;padding-left:0px; padding-right:0px;overflow-y:scroll!important;overflow-x:hidden!important">
                <PetMenu splitViewPosition="0"/>
            </div>
        }
        else if (GameState.activeButtons[0] == "Stats")
        {
            <div class="col-md-3" style="height:100vh;padding-left:0px; padding-right:0px;overflow-y:scroll!important;overflow-x:hidden!important">
                <StatsMenu splitViewPosition="0"/>
            </div>
        }
    }
    if (GameState.activeButtons[1] != null)
    {
        if (GameState.activeButtons[1] == "Inventory")
        {
            <div class="col-md-3" style="height:100vh;padding-left:0px; padding-right:0px;overflow-y:scroll">
                <Inventory splitViewPosition="1"/>
            </div>
        }
        else if (GameState.activeButtons[1] == "Skills")
        {
            <div class="col-md-3" style="height:100vh;padding-left:0px; padding-right:0px;overflow-y:scroll!important;overflow-x:hidden!important">
                <SkillsMenu splitViewPosition="1"/>
            </div>
        }
        else if (GameState.activeButtons[1] == "Crafting")
        {
            <div class="col-md-3" style="height:100vh;padding-left:0px; padding-right:0px;overflow-y:scroll!important;overflow-x:hidden!important">
                <CraftingMenu splitViewPosition="1"/>
            </div>
        }
        else if (GameState.activeButtons[1] == "Followers")
        {
            <div class="col-md-3" style="height:100vh;padding-left:0px; padding-right:0px;overflow-y:scroll!important;overflow-x:hidden!important">
                <FollowersMenu splitViewPosition="1"/>
            </div>
        }
        else if (GameState.activeButtons[1] == "Pets")
        {
            <div class="col-md-3" style="height:100vh;padding-left:0px; padding-right:0px;overflow-y:scroll!important;overflow-x:hidden!important">
                <PetMenu splitViewPosition="1"/>
            </div>
        }
        else if (GameState.activeButtons[1] == "Stats")
        {
            <div class="col-md-3" style="height:100vh;padding-left:0px; padding-right:0px;overflow-y:scroll!important;overflow-x:hidden!important">
                <StatsMenu splitViewPosition="1"/>
            </div>
        }
    }

}
else
{
    if (GameState.activeView == "Inventory")
    { <div class="col align-self-start" style="height:100vh;padding-left:0px; padding-right:0px; min-width:400px;overflow-y:scroll">
            <Inventory />
        </div>

    }
    else if (GameState.activeView == "Skills")
    {
        <div class="col align-self-start" style="height:100vh;padding-left:0px; padding-right:0px; min-width:400px;overflow-y:scroll">
            <SkillsMenu />
        </div>
    }
    else if (GameState.activeView == "Crafting")
    {
        <div class="col align-self-start" style="height:100vh;padding-left:0px; padding-right:0px; min-width:400px;overflow-y:scroll">
            <CraftingMenu />
        </div>
    }
    else if (GameState.activeView == "Followers")
    {
        <div class="col align-self-start" style="height:100vh;padding-left:0px; padding-right:0px; min-width:400px;overflow-y:scroll">
            <FollowersMenu />
        </div>
    }
    else if (GameState.activeView == "Pets")
    {
        <div class="col align-self-start" style="height:100vh;padding-left:0px; padding-right:0px; min-width:400px;overflow-y:scroll">
            <PetMenu />
        </div>
    }
    else if (GameState.activeView == "Stats")
    {
        <div class="col align-self-start" style="height:100vh;padding-left:0px; padding-right:0px; min-width:400px;overflow-y:scroll">
            <StatsMenu />
        </div>
    }
}


@functions{
    private string backURL;

    protected override void OnInitialized()
    {

        GameState.StateChanged += OnGameStateChanged;
        GameState.UpdateState();

        this.StateHasChanged();
    }
    void IDisposable.Dispose()
    {
        GameState.UpdateState();
        GameState.StateChanged -= OnGameStateChanged;
    }
    void OnGameStateChanged(object sender, EventArgs e) => StateHasChanged();
}